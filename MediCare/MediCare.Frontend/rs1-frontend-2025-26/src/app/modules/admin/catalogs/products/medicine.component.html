<div class="container">
  <!-- Header kartica -->
  <div class="header-card mat-elevation-z2">
    <div class="header-card-content">
      <!-- Lijevo: naslov -->
      <h1>{{ 'MEDICINE.TITLE' | translate }}</h1>

      <!-- Desno: search + novi proizvod -->
      <div class="actions-container">
        <mat-form-field class="search-field" appearance="fill">
          <mat-label>{{ 'MEDICINE.SEARCH_PLACEHOLDER' | translate }}</mat-label>
          <input
            matInput
            [placeholder]="'MEDICINE.SEARCH_INPUT_PLACEHOLDER' | translate"
            (keyup)="request.paging.page = 1; loadPagedData()"
            [(ngModel)]="request.search"
          />
          <mat-icon matSuffix>search</mat-icon>
        </mat-form-field>

        <button mat-raised-button color="primary" (click)="onCreate()">
          <mat-icon>add</mat-icon>
          {{ 'MEDICINE.NEW_MEDICINE' | translate }}
        </button>
      </div>
    </div>
  </div>

  <!-- Loading / error -->
  <div *ngIf="isLoading" class="loading">
    {{ 'MEDICINE.LOADING' | translate }}
  </div>

  <div *ngIf="!isLoading && errorMessage" class="error">
    {{ errorMessage }}
  </div>

  <!-- Tabela -->
  <div class="mat-elevation-z8">
    <table mat-table [dataSource]="dataSource" matSort [hidden]="isLoading || errorMessage">

<ng-container matColumnDef="imageFile">
  <th mat-header-cell *matHeaderCellDef>{{'MEDICINE.TABLE.PICTURE' | translate}}</th>
  <td mat-cell *matCellDef="let medicine">
    <img
      [src]="'https://localhost:7260/' + medicine.imagePath"
      alt="{{ medicine.name }}"
      style="width:100px; height:100px; object-fit:contain;"
    />

    </td>
      </ng-container>

      <!-- Naziv -->
      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef mat-sort-header="name">{{ 'MEDICINE.TABLE.NAME' | translate }}</th>
        <td mat-cell *matCellDef="let medicine">
          <span style="font-weight: 500">{{ medicine.name }}</span>
        </td>
      </ng-container>

      <!-- Kategorija -->
      <ng-container matColumnDef="medicineCategoryName">
        <th mat-header-cell *matHeaderCellDef mat-sort-header="medicineCategoryName">{{ 'MEDICINE.TABLE.CATEGORY' | translate }}</th>
        <td mat-cell *matCellDef="let medicine">
          {{ medicine.medicineCategoryName }}
        </td>
      </ng-container>

      <!-- Tezina -->
      <ng-container matColumnDef="weight">
      <th mat-header-cell *matHeaderCellDef mat-sort-header="weight">{{'MEDICINE.TABLE.WEIGHT' | translate}}</th>
      <td mat-cell *matCellDef="let medicine">
        {{ medicine.weight }}
      </td>
      </ng-container>

      <!-- Cijena -->
      <ng-container matColumnDef="price">
        <th mat-header-cell *matHeaderCellDef mat-sort-header="price">{{ 'MEDICINE.TABLE.PRICE' | translate }}</th>
        <td mat-cell *matCellDef="let medicine">
          <span style="font-weight: 600; color: #4976b5"
            >{{ medicine.price | number : '1.2-2' }} KM</span
          >
        </td>
      </ng-container>

      <!-- Aktivno -->
<ng-container matColumnDef="isEnabled">
  <th mat-header-cell *matHeaderCellDef mat-sort-header="isEnabled">
    {{ 'MEDICINE.TABLE.STATUS' | translate }}
  </th>

  <td mat-cell *matCellDef="let medicine">
    <mat-slide-toggle
      [checked]="medicine.isEnabled"
      (change)="onToggleStatus(medicine)"
      color="primary"
      [disabled]="isLoading"
      class="status-toggle"
    >
      <span
        class="status-label"
        [class.enabled]="medicine.isEnabled"
        [class.disabled]="!medicine.isEnabled"
      >
        {{
          medicine.isEnabled
            ? ('MEDICINE.TABLE.ENABLED' | translate)
            : ('MEDICINE.TABLE.DISABLED' | translate)
        }}
      </span>
    </mat-slide-toggle>
  </td>
</ng-container>

      <!-- Akcije -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>{{ 'MEDICINE.TABLE.ACTIONS' | translate }}</th>
        <td mat-cell *matCellDef="let medicine">
          <button
            mat-icon-button
            color="primary"
            (click)="onEdit(medicine)"
            [matTooltip]="'MEDICINE.ACTIONS.EDIT_TOOLTIP' | translate"
          >
            <mat-icon>edit</mat-icon>
          </button>
          <button
            mat-icon-button
            color="warn"
            (click)="onDelete(medicine)"
            [matTooltip]="'MEDICINE.ACTIONS.DELETE_TOOLTIP' | translate"
          >
            <mat-icon>delete</mat-icon>
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>

      <!-- No data -->
      <tr class="mat-row" *matNoDataRow>
        <td class="mat-cell" colspan="7">
          <ng-container *ngIf="request.search; else noDataDefault">
            {{ 'MEDICINE.NO_DATA_FILTER' | translate }}
          </ng-container>
          <ng-template #noDataDefault>
            {{ 'MEDICINE.NO_DATA' | translate }}
          </ng-template>
        </td>
      </tr>
    </table>

    <app-fit-paginator-bar [vm]="this" />
  </div>
</div>
