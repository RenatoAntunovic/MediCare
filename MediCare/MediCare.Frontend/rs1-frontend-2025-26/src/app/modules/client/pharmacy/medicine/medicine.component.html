<div class="container">
  <!-- Header kartica -->
  <div class="header-card mat-elevation-z2">
    <div class="header-card-content">
      <!-- Lijevo: naslov -->
      <h1>{{ 'MEDICINE.TITLE' | translate }}</h1>

            <button mat-icon-button (click)="toggleDarkMode()" aria-label="Toggle Dark Mode">
        <mat-icon>{{ isDarkMode ? 'dark_mode' : 'light_mode' }}</mat-icon>
      </button>

      <mat-form-field class="filter-field" appearance="fill">
  <mat-label>{{ 'MEDICINE.FILTER_CATEGORY' | translate }}</mat-label>

  <mat-select
    [(ngModel)]="categoryFilter"
    (selectionChange)="onCategoryFilterChange($event.value)"
  >
    <!-- Sve kategorije -->
    <mat-option [value]="null">
      {{ 'MEDICINE.ALL_CATEGORIES' | translate }}
    </mat-option>



    <!-- Lista kategorija -->
    <mat-option *ngFor="let category of categories" [value]="category.id">
      <div class="category-option">
        <span>{{ category.name }}</span>
      </div>
    </mat-option>
  </mat-select>

  <mat-icon matSuffix>filter_list</mat-icon>
</mat-form-field>


      <!-- Desno: search + novi proizvod -->
      <div class="actions-container">
        <mat-form-field class="search-field" appearance="fill">
          <mat-label>{{ 'MEDICINE.SEARCH_PLACEHOLDER' | translate }}</mat-label>
          <input
            matInput
            [placeholder]="'MEDICINE.SEARCH_INPUT_PLACEHOLDER' | translate"
            (keyup.enter)="request.paging.page = 1; loadPagedData()"
            [(ngModel)]="request.search"
          />
          <mat-icon matSuffix>search</mat-icon>
        </mat-form-field>
      </div>
    </div>
  </div>

  <!-- Loading / error -->
  <div *ngIf="isLoading" class="loading">
    {{ 'MEDICINE.LOADING' | translate }}
  </div>

  <div *ngIf="!isLoading && errorMessage" class="error">
    {{ errorMessage }}
  </div>

  <!-- Tabela -->
  <div class="mat-elevation-z8" *ngIf="!isLoading && !errorMessage">
    <table mat-table [dataSource]="items">

<ng-container matColumnDef="imageFile">
  <th mat-header-cell *matHeaderCellDef>{{'MEDICINE.TABLE.PICTURE' | translate}}</th>
  <td mat-cell *matCellDef="let medicine">
    <img
      [src]="'https://localhost:7260/' + medicine.imagePath"
      alt="{{ medicine.name }}"
      style="width:100px; height:100px; object-fit:contain;"
    />

    </td>
      </ng-container>

      <!-- Naziv -->
      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef>{{ 'MEDICINE.TABLE.NAME' | translate }}</th>
        <td mat-cell *matCellDef="let medicine">
           <a 
      [routerLink]="['/client/medicine', medicine.id]" 
      style="font-weight: 500; text-decoration: none; color: inherit; cursor: pointer;">
      {{ medicine.name }}
      </a>
        </td>
      </ng-container>

      <!-- Kategorija -->
      <ng-container matColumnDef="medicineCategoryName">
        <th mat-header-cell *matHeaderCellDef>{{ 'MEDICINE.TABLE.CATEGORY' | translate }}</th>
        <td mat-cell *matCellDef="let medicine">
          {{ medicine.medicineCategoryName }}
        </td>
      </ng-container>

      <!-- Tezina -->
      <ng-container matColumnDef="weight">
      <th mat-header-cell *matHeaderCellDef>{{'MEDICINE.TABLE.WEIGHT' | translate}}</th>
      <td mat-cell *matCellDef="let medicine">
        {{ medicine.weight }}
      </td>
      </ng-container>

      <!-- Cijena -->
      <ng-container matColumnDef="price">
        <th mat-header-cell *matHeaderCellDef>{{ 'MEDICINE.TABLE.PRICE' | translate }}</th>
        <td mat-cell *matCellDef="let medicine">
          <span style="font-weight: 600; color: #4976b5"
            >{{ medicine.price | number : '1.2-2' }} KM</span
          >
        </td>
      </ng-container>

      <!-- Aktivno -->
<ng-container matColumnDef="isEnabled">
  <th mat-header-cell *matHeaderCellDef>
    {{ 'MEDICINE.TABLE.STATUS' | translate }}
  </th>

  <td mat-cell *matCellDef="let medicine">
    <span
      class="status-label"
      [ngClass]="{
        'enabled': medicine.isEnabled,
        'disabled': !medicine.isEnabled
      }"
    >
      {{
        medicine.isEnabled
          ? ('MEDICINE.TABLE.ENABLED' | translate)
          : ('MEDICINE.TABLE.DISABLED' | translate)
      }}
    </span>
  </td>
</ng-container>


      <!-- Akcije -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>{{ 'MEDICINE.TABLE.ACTIONS' | translate }}</th>
        <td mat-cell *matCellDef="let medicine">
          <button
            mat-icon-button
            color="warn"
            (click)="addToFavourites(medicine); $event.stopPropagation()"
            [matTooltip]="'MEDICINE.ACTIONS.ADD_TO_FAVOURITES_TOOLTIP' | translate">
            <mat-icon>favorite_border</mat-icon>
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns" (click)="goToMedicineDetail(row)"></tr>

      <!-- No data -->
      <tr class="mat-row" *matNoDataRow>
        <td class="mat-cell" colspan="7">
          <ng-container *ngIf="request.search; else noDataDefault">
            {{ 'MEDICINE.NO_DATA_FILTER' | translate }}
          </ng-container>
          <ng-template #noDataDefault>
            {{ 'MEDICINE.NO_DATA' | translate }}
          </ng-template>
        </td>
      </tr>
    </table>

    <app-fit-paginator-bar [vm]="this" />
  </div>
</div>
